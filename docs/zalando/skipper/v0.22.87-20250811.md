# v0.22.87

## release on 20250811
## description
## changes
Changes

OPA JWT token cache configuration (<a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="3269524401" data-permission-text="Title is private" data-url="https://github.com/zalando/skipper/issues/3572" data-hovercard-type="pull_request" data-hovercard-url="/zalando/skipper/pull/3572/hovercard" href="https://github.com/zalando/skipper/pull/3572">#3572</a>)

Context

With <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2792871367" data-permission-text="Title is private" data-url="https://github.com/open-policy-agent/opa/issues/7274" data-hovercard-type="pull_request" data-hovercard-url="/open-policy-agent/opa/pull/7274/hovercard" href="https://github.com/open-policy-agent/opa/pull/7274">open-policy-agent/opa#7274</a> Open Policy  

Agent added configurable token cache to io.jwt token verification  

built-in functions to improve performance. See  

<a href="https://github.com/open-policy-agent/opa/releases/tag/v1.1.0">changelog</a>.

Changes

With this pull request JWT cache reading and writing is enabled and  

benchmark tests are added to measure JWT validation performance with  

cache configuration.

<strong>Fix in opa-envoy-plugin</strong>  

After initial round of benchmark tests that showed no impact on  

perfomence the bug was found in opa-envoy-plugin and <a href="https://github.com/open-policy-agent/opa-envoy-plugin/pull/748" data-hovercard-type="pull_request" data-hovercard-url="/open-policy-agent/opa-envoy-plugin/pull/748/hovercard">contribution with<br>
the fix was<br>
made</a>.

Benchmark tests result after fix

* results for test with vs without cache configuration

for 10 runs, each 20 s:  

attached:  

<a href="https://github.com/user-attachments/files/21157031/jwt-validation-cache-benchmark-results-10runs-20s.txt">jwt-validation-cache-benchmark-results-10runs-20s.txt</a>

    goarch: arm64
    pkg: github.com/zalando/skipper/filters/openpolicyagent/opaauthorizerequest
    cpu: Apple M1
                                      │       sec/op       │
    JwtValidation/without_jwt_cache-8       20.10µ ± 4%
    JwtValidation/with_jwt_cache-8          10.65µ ± 3%
    geomean                                 14.63µ

                                      │        B/op        │
    JwtValidation/without_jwt_cache-8      38.11Ki ± 0%
    JwtValidation/with_jwt_cache-8         29.89Ki ± 0%
    geomean                                33.75Ki

                                      │     allocs/op      │
    JwtValidation/without_jwt_cache-8        621.0 ± 0%
    JwtValidation/with_jwt_cache-8           512.0 ± 0%
    geomean                                  563.9

* results for test with cache set for max number of 5 tokens in the  
  cache and varying number of tokens in the test (1, 5, 6, 10, 100)

    goarch: arm64
    pkg: github.com/zalando/skipper/filters/openpolicyagent/opaauthorizerequest
    cpu: Apple M1
                                                           │        B/op        │
    JwtValidationWithVaryingTokenCounts/tokens_count_1-8           9.892µ ± 14%
    JwtValidationWithVaryingTokenCounts/tokens_count_5-8           10.38µ ±  9%
    JwtValidationWithVaryingTokenCounts/tokens_count_6-8           13.38µ ±  3%
    JwtValidationWithVaryingTokenCounts/tokens_count_10-8          16.23µ ±  7%
    JwtValidationWithVaryingTokenCounts/tokens_count_100-8         22.25µ ± 14%

                                                           
                                                           │        B/op        │
    JwtValidationWithVaryingTokenCounts/tokens_count_1-8           29.89Ki ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_5-8           29.90Ki ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_6-8           31.78Ki ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_10-8          34.57Ki ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_100-8         38.27Ki ± 0%
    geomean                                                        32.73Ki

                                    
                                                           │     allocs/op      │
    JwtValidationWithVaryingTokenCounts/tokens_count_1-8             512.0 ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_5-8             512.0 ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_6-8             538.0 ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_10-8            577.0 ± 0%
    JwtValidationWithVaryingTokenCounts/tokens_count_100-8           631.5 ± 0%

*** ** * ** ***

Multiarch Docker image

Multiarch Docker image is available in Github's docker registry:

    docker run -it ghcr.io/zalando/skipper:v0.22.87 skipper --help

Docker image

Docker image is available in Zalando's Open Source registry:

    docker run -it registry.opensource.zalan.do/teapot/skipper:v0.22.87 skipper --help


