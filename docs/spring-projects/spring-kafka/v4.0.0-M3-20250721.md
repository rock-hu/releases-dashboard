# v4.0.0-M3

## release on 20250721

## description

## changes

‚≠ê New Features

* Add KafkaListener support for shared consumer containers <a href="https://github.com/spring-projects/spring-kafka/pull/3988" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3988/hovercard">#3988</a>
* Revise Nullability on class <code>MessagingMessageListenerAdapter</code> <a href="https://github.com/spring-projects/spring-kafka/issues/3979" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3979/hovercard">#3979</a>
* propagate scope in async failures <a href="https://github.com/spring-projects/spring-kafka/pull/3950" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3950/hovercard">#3950</a>
* Add Kafka shared consumer container support <a href="https://github.com/spring-projects/spring-kafka/pull/3945" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3945/hovercard">#3945</a>
* support per-record observations in batch listeners <a href="https://github.com/spring-projects/spring-kafka/pull/3944" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3944/hovercard">#3944</a>
* KafkaTestUtils unified consumerPros call <a href="https://github.com/spring-projects/spring-kafka/pull/3938" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3938/hovercard">#3938</a>
* Polish StringOrBytesSerializer <a href="https://github.com/spring-projects/spring-kafka/pull/3933" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3933/hovercard">#3933</a>
* Introduce share consumer factories for Kafka Queues (Early Access) <a href="https://github.com/spring-projects/spring-kafka/pull/3923" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3923/hovercard">#3923</a>
* Add cache to optimize header match performance. <a href="https://github.com/spring-projects/spring-kafka/issues/3879" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3879/hovercard">#3879</a>
* Support for KIP-932 Queues for Kafka <a href="https://github.com/spring-projects/spring-kafka/issues/3875" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3875/hovercard">#3875</a>
* Deprecate JUnit 4 utilities in the project <a href="https://github.com/spring-projects/spring-kafka/issues/3873" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3873/hovercard">#3873</a>
* Necessity of KafkaHandler on single method class <a href="https://github.com/spring-projects/spring-kafka/issues/3807" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3807/hovercard">#3807</a>
* Adds the ability to add record interceptors instead of override them <a href="https://github.com/spring-projects/spring-kafka/issues/3542" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3542/hovercard">#3542</a>

üêû Bug Fixes

* ReplyingKafkaTemplate checks for default reply header name instead of custom one <a href="https://github.com/spring-projects/spring-kafka/issues/3989" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3989/hovercard">#3989</a>
* Random behavior in DelegatingByTypeSerializer based on type of delegates map <a href="https://github.com/spring-projects/spring-kafka/issues/3953" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3953/hovercard">#3953</a>
* MessageListenerContainer when stopped abnormally it sends ConsumerStoppedEvent with Reason as Normal <a href="https://github.com/spring-projects/spring-kafka/issues/3948" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3948/hovercard">#3948</a>
* A constructor that fails to validate null value properly <a href="https://github.com/spring-projects/spring-kafka/issues/3917" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3917/hovercard">#3917</a>
* Delete redundant null check <a href="https://github.com/spring-projects/spring-kafka/issues/3915" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3915/hovercard">#3915</a>
* <a class="issue-link js-issue-link" data-error-text="Failed to load title" data-id="2796111502" data-permission-text="Title is private" data-url="https://github.com/spring-projects/spring-kafka/issues/3712" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3712/hovercard" href="https://github.com/spring-projects/spring-kafka/issues/3712">GH-3712</a>: Make ContainerPausingBackOffHandler working in batch mode. <a href="https://github.com/spring-projects/spring-kafka/pull/3885" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3885/hovercard">#3885</a>
* Should fail bean registration when no method listeners are registered. <a href="https://github.com/spring-projects/spring-kafka/issues/3869" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3869/hovercard">#3869</a>

üìî Documentation

* Fix typos <a href="https://github.com/spring-projects/spring-kafka/pull/3928" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3928/hovercard">#3928</a>
* Documentation: Clarify exception handlings behaviour for Error vs RuntimeException <a href="https://github.com/spring-projects/spring-kafka/issues/3884" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3884/hovercard">#3884</a>
* The DefaultHandler resolves an incorrect value for the parameter annotated with <code>@Header</code>. <a href="https://github.com/spring-projects/spring-kafka/issues/3880" data-hovercard-type="issue" data-hovercard-url="/spring-projects/spring-kafka/issues/3880/hovercard">#3880</a>

üî® Dependency Upgrades

* Bump io.micrometer:micrometer-tracing-bom from 1.5.1 to 1.5.2 <a href="https://github.com/spring-projects/spring-kafka/pull/4007" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/4007/hovercard">#4007</a>
* Bump com.fasterxml.jackson:jackson-bom from 2.19.1 to 2.19.2 <a href="https://github.com/spring-projects/spring-kafka/pull/4006" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/4006/hovercard">#4006</a>
* Bump io.micrometer:micrometer-bom from 1.15.1 to 1.15.2 <a href="https://github.com/spring-projects/spring-kafka/pull/4005" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/4005/hovercard">#4005</a>
* Bump org.junit:junit-bom from 5.13.2 to 5.13.3 <a href="https://github.com/spring-projects/spring-kafka/pull/3991" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3991/hovercard">#3991</a>
* Bump org.junit:junit-bom from 5.13.1 to 5.13.2 <a href="https://github.com/spring-projects/spring-kafka/pull/3986" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3986/hovercard">#3986</a>
* Bump io.micrometer:micrometer-tracing-bom from 1.5.0 to 1.5.1 <a href="https://github.com/spring-projects/spring-kafka/pull/3973" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3973/hovercard">#3973</a>
* Bump com.fasterxml.jackson:jackson-bom from 2.19.0 to 2.19.1 <a href="https://github.com/spring-projects/spring-kafka/pull/3972" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3972/hovercard">#3972</a>
* Bump io.micrometer:micrometer-bom from 1.15.0 to 1.15.1 <a href="https://github.com/spring-projects/spring-kafka/pull/3971" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3971/hovercard">#3971</a>
* Bump org.junit:junit-bom from 5.13.0 to 5.13.1 <a href="https://github.com/spring-projects/spring-kafka/pull/3951" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3951/hovercard">#3951</a>
* Bump io.projectreactor:reactor-bom from 2024.0.5 to 2024.0.6 <a href="https://github.com/spring-projects/spring-kafka/pull/3896" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3896/hovercard">#3896</a>
* Bump org.springframework.retry:spring-retry from 2.0.11 to 2.0.12 <a href="https://github.com/spring-projects/spring-kafka/pull/3893" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3893/hovercard">#3893</a>
* Bump kotlinVersion from 2.1.20 to 2.1.21 <a href="https://github.com/spring-projects/spring-kafka/pull/3892" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3892/hovercard">#3892</a>
* Bump com.fasterxml.jackson:jackson-bom from 2.18.3 to 2.18.4 <a href="https://github.com/spring-projects/spring-kafka/pull/3889" data-hovercard-type="pull_request" data-hovercard-url="/spring-projects/spring-kafka/pull/3889/hovercard">#3889</a>

‚ù§Ô∏è Contributors

Thank you to all the contributors who worked on this release:

<a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/AlamuriLokesh/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/AlamuriLokesh">@AlamuriLokesh</a>, <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/bandalgomsu/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/bandalgomsu">@bandalgomsu</a>, <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/chickenchickenlove/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/chickenchickenlove">@chickenchickenlove</a>, <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/igormq/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/igormq">@igormq</a>, <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/mipo256/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/mipo256">@mipo256</a>, <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/ngocnhan-tran1996/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/ngocnhan-tran1996">@ngocnhan-tran1996</a>, <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/sh-cho/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/sh-cho">@sh-cho</a>, and <a class="user-mention notranslate" data-hovercard-type="user" data-hovercard-url="/users/sobychacko/hovercard" data-octo-click="hovercard-link-click" data-octo-dimensions="link_type:self" href="https://github.com/sobychacko">@sobychacko</a>

